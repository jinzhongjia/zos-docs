一个汇编语言可以被分为三个部分，他们分别是：data段，bbs段，text段

## data

该段用于定义初始化数据和常量，data段在运行时不会被修改。在这里你可以定义很多常量、文件名、缓冲区大小等等 ...

定义`data`段的语法为：

```asm
section.data
```

## bss

该段用于定义变量，bss段不在可执行文件中，由系统初始化。

定义`bss`段语法为：

```asm
section.data
```

## text

该段用来保存实际运行的代码，编译时确定， 只读（如果处理器有MMU单元）。并且最开始必须以声明`global _start`（用来告诉内核程序开始执行的地方）开始。

更进一步讲是存放处理器的机器指令，当各个源文件单独编译之后生成目标文件，经连接器链接各个目标文件并解决各个源文件之间函数的引用，与此同时，还得将所有目标文件中的.text段合在一起，但不是简单的将它们“堆”在一起就完事，还需要处理各个段之间的函数引用问题。

定义`text`段的语法为：

```asm
section.text
   global _start
_start:
```

### 小提示

bss不占用可执行文件空间，其内容由操作系统初始化（清零），裸机程序需要自行手动清零。

data段则需要占用可执行文件空间，其内容由程序初始化。

全局的未初始化变量存在于bss段中，具体体现为一个占位符，全局的已初始化变量存于data段中，而函数内的自动变量都在栈上分配空间。

## 注释

就如同常规的c注释中的 `//` 一样，在汇编中，我们使用 `;` 进行注释，它可以包含任何可打印字符（包括空格），可以单起一行，也可以在一行最后

```asm
; This program displays a message on screen
add eax, ebx     ; adds ebx to eax
```

## 汇编语言语句

一个汇编程序包含三种语句：

- 可执行指令
- 汇编伪指令
- 宏定义

`可执行指令`通常是用来告诉处理器接下来应该做什么，每条指令都包含一个`操作码`，每条可执行指令可以被编译成一个机器语言指令。

`汇编伪指令`告诉汇编程序汇编过程的一些信息，它们都是不会执行的，也不会生成机器语言指令。

`宏指令`实际上是一种文本替换机制，你可以简单看作c中的宏定义。

## 语法

每行一句汇编指令，均遵循以下形式：

```
[label]   mnemonic   [operands]   [;comment]
; label 标签用来标记程序点，方便跳转
; mnemonic 助记词，可以简单看作是c中的保留字和函数名称的结合
; operands 操作数，包含源操作数和目的操作数
; comment 注释
; 以上用[]括住的均为非必须存在的，也就是一个汇编语句可以只有一个助记符
; 例如cli,它的作用就是中断屏蔽
```

下面是一些常用的汇编语句：

```asm

INC COUNT        ; 对变量COUNT加一操作

MOV TOTAL, 48    ; 将字面量48移动到变量TOTAL中

ADD AH, BH       ; 将寄存器BH中的值添加到AH 

AND MASK1, 128   ; 对两个数进行逻辑与操作

ADD MARKS, 10    ; 将10添加到变量MARKS中

MOV AL, 10       ; 将10移动到AL寄存器中

```

关于以上的汇编语句，你不认识也没关系，后面我们会学到！

## Hello World!

我们尝试来用汇编写一个经典的`Hello, world!`

```asm
section	.text
   global _start     ;必须定义用于链接器(ld)
	
_start:	            ;告诉链接器程序入口
   mov	edx,len     ;消息长度
   mov	ecx,msg     ;移动消息地址
   mov	ebx,1       ;文件描述符 (这里指向标准输出，stdout)
   mov	eax,4       ;系统调用号 (系统调用，sys_write)
   int	0x80        ;进行系统调用
	
   mov	eax,1       ;系统调用号 (系统调用，sys_exit)
   int	0x80        ;进行系统调用

section	.data
msg db 'Hello, world!', 0xa  ;这里存储打印的字符
len equ $ - msg     ;字符串的长度
```

接下来进行编译，你要确保你已经正确设置好了`nasm`和`ld`

1. 用文本编辑器输入并保存这些代码，文件名为`hello.asm`

2. 使用`nasm`进行编译：

```asm
nasm -f elf hello.asm
```

3. 预期是不会报告任何错误的，有的话系统会提示你。正常的话`nasm`会创建一个名字叫`hello.o`的目标文件
4. 然后使用`ld`进行链接：
```asm
ld -m elf_i386 -s -o hello hello.o
```
5. 然后命令行输入`./hello`，`ld`默认应该会赋予编译结果可执行权限

以上步骤执行完毕后，你应该可以在屏幕上看到输出`Hello, world!`